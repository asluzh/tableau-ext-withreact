import{j as e,t as d,r as i,d as f,c as p,R as y}from"./settings-C6THL_L0.js";function m({dashboard:r,settings:o}){return console.log("[Extension.tsx] Render on dashboard:",r),e.jsx(e.Fragment,{children:e.jsx("div",{className:"centerOnPage",children:e.jsx(d.Button,{kind:o.buttonStyle,disabled:!1,onClick:()=>{console.log("Button clicked")},children:o.buttonLabel})})})}function j(){const[r,o]=i.useState({}),[l,u]=i.useState(0),[g,x]=i.useState({});i.useEffect(()=>((async()=>{await tableau.extensions.initializeAsync({configure:b}),o(tableau.extensions.dashboardContent.dashboard);const n=tableau.extensions.settings.getAll();Object.keys(n).length>0?(await new Promise(t=>setTimeout(t,1e3)),c(n)):u(1)})(),()=>{}),[]);function c(n){try{const t={...f};"metaVersion"in n&&parseInt(n.metaVersion)&&(t.metaVersion=parseInt(n.metaVersion),t.buttonLabel=n.buttonLabel,t.buttonStyle=n.buttonStyle,x(t),u(2))}catch(t){console.error("Error updating settings:",t)}}const b=()=>{let n="config.html";const t=tableau.extensions.environment.tableauVersion.split(".");if(parseInt(t[0],10)===2018||parseInt(t[0],10)===2019&&parseInt(t[1],10)<3){const a=window.location.href;n=window.location.href.substring(0,a.lastIndexOf("/"))+"/config.html"}(async()=>{const a=tableau.extensions.settings.addEventListener(tableau.TableauEventType.SettingsChanged,s=>{c(tableau.extensions.settings.getAll())});try{if(await tableau.extensions.ui.displayDialogAsync(n,"",{height:650,width:500})&&a===void 0){const h=tableau.extensions.settings.getAll();c(h)}}catch(s){if(typeof s=="object"&&s!==null&&"errorCode"in s)switch(s.errorCode){case tableau.ErrorCodes.DialogClosedByUser:break;default:console.error("[ExtensionWrapper.tsx]",s)}}finally{a&&a()}})()};return e.jsxs(e.Fragment,{children:[l===0&&e.jsx("div",{"aria-busy":"true",className:"overlay",children:e.jsx("div",{className:"centerOnPage",children:e.jsx(d.Spinner,{color:"dark"})})}),l===1&&e.jsx("div",{className:"centerOnPage",children:e.jsx(d.Button,{kind:"outline",onClick:b,children:"Configure Extension"})}),l===2&&e.jsx(m,{dashboard:r,settings:g})]})}p.createRoot(document.getElementById("root")).render(e.jsx(y.StrictMode,{children:e.jsx(j,{})}));
